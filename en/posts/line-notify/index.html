<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Line Notify &middot;  My Hugo Blog" />
  
  <meta property="og:site_name" content="My Hugo Blog" />
  <meta property="og:url" content="https://coolgood88142.github.io/en/posts/line-notify/" />
  
  
    <meta property="og:type" content="article" />
    
    <meta property="og:article:published_time" content="2020-05-20T00:00:00Z" />
    
  

  <title>
     Line Notify &middot;  My Hugo Blog
  </title>

  <link rel="alternative stylesheet" href="https://coolgood88142.github.io/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://coolgood88142.github.io/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://coolgood88142.github.io/css/main.css" />
  <link rel="stylesheet" href="https://coolgood88142.github.io/css/github.css" />
  <link rel="stylesheet" href="https://coolgood88142.github.io/css/color-theme.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="https://coolgood88142.github.io/images/favicon.ico" />
  <link rel="apple-touch-icon" href="https://coolgood88142.github.io/images/apple-touch-icon.png" />

  

  
</head>
<body>
  
  <header class="global-header"  style="background-image:url(https://coolgood88142.github.io/images/bg.jpg)">
  
    <section class="header-text">
      <h1><a href="https://coolgood88142.github.io/en/">My Hugo Blog</a></h1>
      
      
        <a class="btn btn-default btn-home" href="https://coolgood88142.github.io/en/">
          <i class="fa fa-angle-left" aria-hidden="true"></i>
          &nbsp;Home
        </a>
      
      
      <div class="navbar-container">
        
          <a class="btn btn-default navbar-item" href="https://coolgood88142.github.io/en/">
            About
          </a>
        
          <a class="btn btn-default navbar-item" href="https://coolgood88142.github.io/en/">
            Categories
          </a>
        
          <a class="btn btn-default navbar-item" href="https://coolgood88142.github.io/en/">
            Home
          </a>
        
          <a class="btn btn-default navbar-item" href="https://coolgood88142.github.io/en/">
            Tags
          </a>
        
      </div>
      
      
      
      
      
      
      
      
      
      
      
        <div class="language-container">
          
            <a class="btn btn-default language-button" href="https://coolgood88142.github.io/en/posts/line-notify/">English</a>
          
            <a class="btn btn-default language-button" href="https://coolgood88142.github.io/zh-tw/posts/line-notify/">中文</a>
          
        </div>
      
    </section>
  </header>
  <main class="container">



<article>
  <header class="article-title">
    <h1 class="text-primary">Line Notify</h1>
  </header>
  <div class="delimiter"></div>
  <section>
    <h2 id="line-notify">Line Notify</h2>
<p>Line Notify是Line 的推播通知服務，是一個單向傳輸文字、圖片等訊息，而且還免費，不會被依訊息則數來收費。它是一個官方帳號，加入好友後，用他接收你的服務發送過來的推播訊息。</p>
<p>以下介紹使用Google日曆行程結合Line Notify前10分鐘推播提醒通知</p>
<h4 id="1建立line-notify服務">1.建立Line Notify服務</h4>
<p>先登入<a href="https://notify-bot.line.me/zh_TW/">Line Notify</a>頁面，登入之後點選個人頁面，請先將Line Nofify官方帳號加入好友，之後在點選發行權杖，</p>
<p>輸入名稱後選擇<strong>透過1對1聊天接收LINE Notify通知</strong>，這時會產生一個金鑰，等等程式會用到。</p>
<p><strong>一定要加入好友才可以收到推播訊息</strong></p>
<p><img src="https://raw.githubusercontent.com/coolgood88142/markdown_note/master/assets/images/line3.png" alt="line3"></p>
<p><img src="C:%5Cxampp%5Chtdocs%5Cmarkdown_note%5Cassets%5Cimages%5Cline4.png" alt="line4"></p>
<p><img src="https://raw.githubusercontent.com/coolgood88142/markdown_note/master/assets/images/line1.png" alt="line1"></p>
<p><img src="https://raw.githubusercontent.com/coolgood88142/markdown_note/master/assets/images/line2.png" alt="line2"></p>
<h4 id="2新增google-app-script專案">2.新增Google App Script專案</h4>
<p>登入Google帳號後，在Google雲端硬碟的新增Google App Script專案，新增專案後補上程式碼後儲存。</p>
<p>程式碼中的ID在Google日曆的設定裡，點選<strong>我的日曆的設定</strong>，選擇要提醒的日曆，在整合日曆的日曆ID，通常是google帳號。</p>
<p><img src="https://raw.githubusercontent.com/coolgood88142/markdown_note/master/assets/images/app_script1.png" alt="app_script1"></p>
<p>以下程式碼是在進行日曆提醒功能：</p>
<p>程式碼.gs</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCalendar</span>() {
  <span style="color:#75715e">//以下說明日曆行程提醒的程式碼
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//透過ID取得日曆
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">cal</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">CalendarApp</span>.<span style="color:#a6e22e">getCalendarById</span>(<span style="color:#e6db74">&#34;xxxxxx@gmail.com&#34;</span>);
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">today</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">todayHours</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">today</span>.<span style="color:#a6e22e">getHours</span>();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">todayMinutes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">today</span>.<span style="color:#a6e22e">getMinutes</span>() <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span>;
  
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">cal</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>){
    <span style="color:#75715e">//設定查詢日期區間
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">tenMinutes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date(<span style="color:#a6e22e">today</span>.<span style="color:#a6e22e">getFullYear</span>(), <span style="color:#a6e22e">today</span>.<span style="color:#a6e22e">getMonth</span>(), <span style="color:#a6e22e">today</span>.<span style="color:#a6e22e">getDate</span>(), <span style="color:#a6e22e">todayHours</span>, <span style="color:#a6e22e">todayMinutes</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cal</span>.<span style="color:#a6e22e">getEvents</span>(<span style="color:#a6e22e">today</span>, <span style="color:#a6e22e">tenMinutes</span>);
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
      
      <span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">el</span>, <span style="color:#a6e22e">index</span>){
        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">startTime</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">getStartTime</span>();
        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">hours</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startTime</span>.<span style="color:#a6e22e">getHours</span>();
        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">minutes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">startTime</span>.<span style="color:#a6e22e">getMinutes</span>();
        
        <span style="color:#75715e">//先判斷現在時間是否為行程時間的前10分鐘
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">todayHours</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">hours</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">todayMinutes</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">minutes</span>){
          <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>;
          <span style="color:#66d9ef">return</span>;
        }
      });
      
      <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">data</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#39;</span>){
        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">getTitle</span>();  <span style="color:#75715e">//標題
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">description</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">getDescription</span>();  <span style="color:#75715e">//說明
</span><span style="color:#75715e"></span>        
        <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n標題：&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">title</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n描述：&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">description</span>;
        <span style="color:#a6e22e">sendMessage</span>(<span style="color:#a6e22e">text</span>);
      }
      <span style="color:#a6e22e">Logger</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">text</span>);
      
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#a6e22e">Logger</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;查詢的行程不存在！&#34;</span>);
    }
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">Logger</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;日曆不存在！&#34;</span>);
  }
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendMessage</span>(<span style="color:#a6e22e">message</span>) {
  <span style="color:#75715e">//Line的發行權杖
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">token</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;OAs8mSPN4PXwhR2gsSFJAaJu7pjkZNlzlC2jd0&#34;</span>;

  <span style="color:#75715e">//組好訊息的資料，使用Line發送訊息
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span>
   {
     <span style="color:#e6db74">&#34;method&#34;</span>  <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;post&#34;</span>,
     <span style="color:#e6db74">&#34;payload&#34;</span> <span style="color:#f92672">:</span> {<span style="color:#e6db74">&#34;message&#34;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>},
     <span style="color:#e6db74">&#34;headers&#34;</span> <span style="color:#f92672">:</span> {<span style="color:#e6db74">&#34;Authorization&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">token</span>}
   };
   <span style="color:#a6e22e">UrlFetchApp</span>.<span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;https://notify-api.line.me/api/notify&#34;</span>, <span style="color:#a6e22e">options</span>);

}

</code></pre></div><p>用getCalendar function取得現在時間後10分鐘，判斷現在是否為日曆行程前10分鐘，是的話執行sendMessage function 組提醒訊息後發送。</p>
<p>要在專案的啟動程序設定每分鐘執行getCalendar function，只有在日曆上有設定行程，系統會在前10分鐘發送訊息。</p>
<p>UrlFetchApp.fetch是google app script的function，主要是用Get或Post請求url網址，以上範例是請求line notify的api，執行發送訊息。</p>
<h4 id="3設定排程執行日曆行程提醒">3.設定排程執行日曆行程提醒</h4>
<p>在專案裡點選現有專案的啟動程序，再新增觸發條件，設定每分鐘執行getCalendar，儲存時google會詢問是否要讓專案執行程序，需要google帳號使用者允許權限才可以執行。</p>
<p><img src="https://raw.githubusercontent.com/coolgood88142/markdown_note/master/assets/images/app_script2.png" alt="app_script2"></p>
<p><img src="https://raw.githubusercontent.com/coolgood88142/markdown_note/master/assets/images/app_script3.png" alt="app_script3"></p>
<h4 id="4設定日曆行程">4.設定日曆行程</h4>
<p>在日曆上設定好行程後，系統偵測行程前10分鐘執行通知訊息。</p>
<p>參考資料:</p>
<p><a href="https://chibupapa.com/2019/11/12/line-notify/">https://chibupapa.com/2019/11/12/line-notify/</a>、</p>
<p><a href="https://notify-bot.line.me/zh_TW/">https://notify-bot.line.me/zh_TW/</a>、</p>
<p><a href="https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app">https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app</a></p>

  </section>
  <div class="clearfix">
    
      <div class="post-date pull-left">
        <span class="small">
          Posted on
          May 20, 2020 at 00:00
        </span>
      </div>
    
    <div class="pull-right">
      
    </div>
  </div>
  <footer>
    
	
      
        <div class="delimiter"></div>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'Kai88142';
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      
    
    <div class="delimiter"></div>
    <div class="pager-container">
      
        <a class="btn btn-primary btn-older-posts" href="https://coolgood88142.github.io/en/posts/heroku/">
          <div>
            <span aria-hidden="true">&larr;</span> Older Posts
          </div>
        </a>
      
      
        <a class="btn btn-primary btn-newer-posts" href="https://coolgood88142.github.io/en/posts/vision/">
          <div>
            Newer Posts <span aria-hidden="true">&rarr;</span>
          </div>
        </a>
      
    </div>
  </footer>
</article>
<div class="delimiter"></div>

  </main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
      
    </div>
    <div class="sns-links hidden-print">
  
  
  
  
  
  
  
  
  
  
  
  
</div>

  </footer>

  
  
  

  
  

  
</body>
</html>

